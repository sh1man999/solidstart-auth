import{createComponent as p,isServer as S,getRequestEvent as q,delegateEvents as M,spread as k,useAssets as B,ssr as D,escape as x}from"solid-js/web";import{children as V,createMemo as R,getOwner as W,untrack as H,Show as U,on as J,createRoot as _,createSignal as z,onCleanup as A,createContext as G,sharedConfig as Q,createUniqueId as X,useContext as Y,createRenderEffect as Z,Suspense as ee}from"solid-js";import{c as te,a as ne,R as re,g as E,b as oe,d as ae,e as ie,m as se,f as ce,k as ue,s as le,h as de,n as me,F as fe}from"./server-fns.mjs";import"solid-js/web/storage";import"./rpc.mjs";import"h3";import"node:async_hooks";const $=e=>t=>{const{base:n}=t,r=V(()=>t.children),a=R(()=>te(r(),t.base||""));let c;const o=ne(e,()=>c,a,{base:n,singleFlight:t.singleFlight}),u=o.location;return e.create&&e.create(o),p(re.Provider,{value:o,get children(){return p(he,{location:u,get root(){return t.root},get load(){return t.rootLoad},get children(){return[(c=W())&&null,p(pe,{routerState:o,get branches(){return a()}})]}})}})};function he(e){const t=e.location,n=R(()=>e.load&&H(()=>e.load({params:{},location:t,intent:"preload"})));return p(U,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:r=>p(r,{params:{},location:t,get data(){return n()},get children(){return e.children}})})}function pe(e){const t=R(()=>E(e.branches,e.routerState.location.pathname));if(S){const o=q();if(o&&o.router&&o.router.dataOnly){ge(o,e.routerState,e.branches);return}o&&((o.router||(o.router={})).matches||(o.router.matches=t().map(({route:u,path:d,params:g})=>({path:u.originalPath,pattern:u.pattern,match:d,params:g,info:u.info}))))}const n=oe(()=>{const o=t(),u={};for(let d=0;d<o.length;d++)Object.assign(u,o[d].params);return u}),r=[];let a;const c=R(J(t,(o,u,d)=>{let g=u&&o.length===u.length;const h=[];for(let m=0,v=o.length;m<v;m++){const b=u&&u[m],i=o[m];d&&b&&i.route.key===b.route.key?h[m]=d[m]:(g=!1,r[m]&&r[m](),_(s=>{r[m]=s,h[m]=ae(e.routerState,h[m-1]||e.routerState.base,N(()=>c()[m+1]),()=>t()[m],n)}))}return r.splice(o.length).forEach(m=>m()),d&&g?d:(a=h[0],h)}));return N(()=>c()&&a)()}const N=e=>()=>p(U,{get when(){return e()},keyed:!0,children:t=>p(ie.Provider,{value:t,get children(){return t.outlet()}})});function ge(e,t,n){const r=new URL(e.request.url),a=E(n,new URL(e.router.previousUrl||e.request.url).pathname),c=E(n,r.pathname);for(let o=0;o<c.length;o++){(!a[o]||c[o].route!==a[o].route)&&(e.router.dataOnly=!0);const{route:u,params:d}=c[o];u.load&&u.load({params:d,location:t.location,intent:"preload"})}}function be([e,t],n,r){return[n?()=>n(e()):e,r?a=>t(r(a)):t]}function we(e){if(e==="#")return null;try{return document.querySelector(e)}catch{return null}}function ve(e){let t=!1;const n=a=>typeof a=="string"?{value:a}:a,r=be(z(n(e.get()),{equals:(a,c)=>a.value===c.value}),void 0,a=>(!t&&e.set(a),a));return e.init&&A(e.init((a=e.get())=>{t=!0,r[1](n(a)),t=!1})),$({signal:r,create:e.create,utils:e.utils})}function ye(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function Re(e,t){const n=we(`#${e}`);n?n.scrollIntoView():t&&window.scrollTo(0,0)}function Ce(e){const t=new URL(e);return t.pathname+t.search}function Ee(e){let t;const n={value:e.url||(t=q())&&Ce(t.request.url)||""};return $({signal:[()=>n,r=>Object.assign(n,r)]})(e)}function Le(e=!0,t=!1,n="/_server"){return r=>{const a=r.base.path(),c=r.navigatorFactory(r.base);let o={};function u(i){return i.namespaceURI==="http://www.w3.org/2000/svg"}function d(i){if(i.defaultPrevented||i.button!==0||i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)return;const s=i.composedPath().find(T=>T instanceof Node&&T.nodeName.toUpperCase()==="A");if(!s||t&&!s.hasAttribute("link"))return;const f=u(s),l=f?s.href.baseVal:s.href;if((f?s.target.baseVal:s.target)||!l&&!s.hasAttribute("state"))return;const w=(s.getAttribute("rel")||"").split(/\s+/);if(s.hasAttribute("download")||w&&w.includes("external"))return;const y=f?new URL(l,document.baseURI):new URL(l);if(!(y.origin!==window.location.origin||a&&y.pathname&&!y.pathname.toLowerCase().startsWith(a.toLowerCase())))return[s,y]}function g(i){const s=d(i);if(!s)return;const[f,l]=s,P=r.parsePath(l.pathname+l.search+l.hash),w=f.getAttribute("state");i.preventDefault(),c(P,{resolve:!1,replace:f.hasAttribute("replace"),scroll:!f.hasAttribute("noscroll"),state:w&&JSON.parse(w)})}function h(i){const s=d(i);if(!s)return;const[f,l]=s;o[l.pathname]||r.preloadRoute(l,f.getAttribute("preload")!=="false")}function m(i){const s=d(i);if(!s)return;const[f,l]=s;o[l.pathname]||(o[l.pathname]=setTimeout(()=>{r.preloadRoute(l,f.getAttribute("preload")!=="false"),delete o[l.pathname]},200))}function v(i){const s=d(i);if(!s)return;const[,f]=s;o[f.pathname]&&(clearTimeout(o[f.pathname]),delete o[f.pathname])}function b(i){let s=i.submitter&&i.submitter.hasAttribute("formaction")?i.submitter.getAttribute("formaction"):i.target.getAttribute("action");if(!s)return;if(!s.startsWith("https://action/")){const l=new URL(s,se);if(s=r.parsePath(l.pathname+l.search),!s.startsWith(n))return}if(i.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const f=ce.get(s);if(f){i.preventDefault();const l=new FormData(i.target);i.submitter&&i.submitter.name&&l.append(i.submitter.name,i.submitter.value),f.call({r,f:i.target},l)}}M(["click","submit"]),document.addEventListener("click",g),e&&(document.addEventListener("mouseover",m),document.addEventListener("mouseout",v),document.addEventListener("focusin",h),document.addEventListener("touchstart",h)),document.addEventListener("submit",b),A(()=>{document.removeEventListener("click",g),e&&(document.removeEventListener("mouseover",m),document.removeEventListener("mouseout",v),document.removeEventListener("focusin",h),document.removeEventListener("touchstart",h)),document.removeEventListener("submit",b)})}}function Oe(e){if(S)return Ee(e);const t=()=>({value:window.location.pathname+window.location.search+window.location.hash,state:window.history.state}),n=de();return ve({get:t,set({value:r,replace:a,scroll:c,state:o}){a?window.history.replaceState(ue(o),"",r):window.history.pushState(o,"",r),Re(window.location.hash.slice(1),c),le()},init:r=>ye(window,"popstate",me(r,a=>{if(a&&a<0)return!n.confirm(a);{const c=t();return!n.confirm(c.value,{state:c.state})}})),create:Le(e.preload,e.explicitLinks,e.actionBase),utils:{go:r=>window.history.go(r),beforeLeave:n}})(e)}const F=G(),I=["title","meta"],L=[],O=["name","http-equiv","content","charset","media"].concat(["property"]),C=(e,t)=>{const n=Object.fromEntries(Object.entries(e.props).filter(([r])=>t.includes(r)).sort());return(Object.hasOwn(n,"name")||Object.hasOwn(n,"property"))&&(n.name=n.name||n.property,delete n.property),e.tag+JSON.stringify(n)};function Se(){if(!Q.context){const n=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(n,r=>r.parentNode.removeChild(r))}const e=new Map;function t(n){if(n.ref)return n.ref;let r=document.querySelector(`[data-sm="${n.id}"]`);return r?(r.tagName.toLowerCase()!==n.tag&&(r.parentNode&&r.parentNode.removeChild(r),r=document.createElement(n.tag)),r.removeAttribute("data-sm")):r=document.createElement(n.tag),r}return{addTag(n){if(I.indexOf(n.tag)!==-1){const c=n.tag==="title"?L:O,o=C(n,c);e.has(o)||e.set(o,[]);let u=e.get(o),d=u.length;u=[...u,n],e.set(o,u);let g=t(n);n.ref=g,k(g,n.props);let h=null;for(var r=d-1;r>=0;r--)if(u[r]!=null){h=u[r];break}return g.parentNode!=document.head&&document.head.appendChild(g),h&&h.ref&&document.head.removeChild(h.ref),d}let a=t(n);return n.ref=a,k(a,n.props),a.parentNode!=document.head&&document.head.appendChild(a),-1},removeTag(n,r){const a=n.tag==="title"?L:O,c=C(n,a);if(n.ref){const o=e.get(c);if(o){if(n.ref.parentNode){n.ref.parentNode.removeChild(n.ref);for(let u=r-1;u>=0;u--)o[u]!=null&&document.head.appendChild(o[u].ref)}o[r]=null,e.set(c,o)}else n.ref.parentNode&&n.ref.parentNode.removeChild(n.ref)}}}}function Ae(){const e=[];return B(()=>D(ke(e))),{addTag(t){if(I.indexOf(t.tag)!==-1){const n=t.tag==="title"?L:O,r=C(t,n),a=e.findIndex(c=>c.tag===t.tag&&C(c,n)===r);a!==-1&&e.splice(a,1)}return e.push(t),e.length},removeTag(t,n){}}}const Pe=e=>{const t=S?Ae():Se();return p(F.Provider,{value:t,get children(){return e.children}})},K=(e,t,n)=>(Te({tag:e,props:t,setting:n,id:X(),get name(){return t.name||t.property}}),null);function Te(e){const t=Y(F);if(!t)throw new Error("<MetaProvider /> should be in the tree");Z(()=>{const n=t.addTag(e);A(()=>t.removeTag(e,n))})}function ke(e){return e.map(t=>{const r=Object.keys(t.props).map(c=>c==="children"?"":` ${c}="${x(t.props[c],!0)}"`).join(""),a=t.props.children;return t.setting?.close?`<${t.tag} data-sm="${t.id}"${r}>${t.setting?.escape?x(a):a||""}</${t.tag}>`:`<${t.tag} data-sm="${t.id}"${r}/>`}).join("")}const xe=e=>K("title",e,{escape:!0,close:!0}),j=e=>K("meta",e);function Ke(){return p(Oe,{root:e=>p(Pe,{get children(){return[[p(xe,{children:"PDF parser"}),p(j,{charset:"utf-8"}),p(j,{content:"width=device-width, initial-scale=1",name:"viewport"})],p(ee,{get children(){return e.children}})]}}),get children(){return p(fe,{})}})}export{Ke as default};
