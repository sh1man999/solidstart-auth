import{getRequestEvent as C}from"solid-js/web";import{provideRequestEvent as E}from"solid-js/web/storage";import{H3Event as p,setResponseStatus as A,getCookie as q,setCookie as T,deleteCookie as $,setHeader as k,getRequestIP as L,getResponseStatus as P,getResponseStatusText as I,getRequestURL as U,getResponseHeaders as O,getResponseHeader as W,setResponseHeader as j,appendResponseHeader as F,removeResponseHeader as N,getRequestWebStream as K}from"h3";import{AsyncLocalStorage as M}from"node:async_hooks";function B(t={}){let e,n=!1;const r=s=>{if(e&&e!==s)throw new Error("Context conflict")};let a;if(t.asyncContext){const s=t.AsyncLocalStorage||globalThis.AsyncLocalStorage;s?a=new s:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const c=()=>{if(a&&e===void 0){const s=a.getStore();if(s!==void 0)return s}return e};return{use:()=>{const s=c();if(s===void 0)throw new Error("Context is not available");return s},tryUse:()=>c(),set:(s,i)=>{i||r(s),e=s,n=!0},unset:()=>{e=void 0,n=!1},call:(s,i)=>{r(s),e=s;try{return a?a.run(s,i):i()}finally{n||(e=void 0)}},async callAsync(s,i){e=s;const u=()=>{e=s},h=()=>e===s?u:void 0;m.add(h);try{const x=a?a.run(s,i):i();return n||(e=void 0),await x}finally{m.delete(h)}}}}function G(t={}){const e={};return{get(n,r={}){return e[n]||(e[n]=B({...t,...r})),e[n],e[n]}}}const f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},R="__unctx__",X=f[R]||(f[R]=G()),z=(t,e={})=>X.get(t,e),v="__unctx_async_handlers__",m=f[v]||(f[v]=new Set);function D(t){let e;const n=H(t),r={duplex:"half",method:t.method,headers:t.headers};return t.node.req.body instanceof ArrayBuffer?new Request(n,{...r,body:t.node.req.body}):new Request(n,{...r,get body(){return e||(e=ae(t),e)}})}function J(t){return t.web??={request:D(t),url:H(t)},t.web.request}function Q(){return le()}const w=Symbol("$HTTPEvent");function V(t){return typeof t=="object"&&(t instanceof p||t?.[w]instanceof p||t?.__is_event__===!0)}function o(t){return function(...e){let n=e[0];if(V(n))e[0]=n instanceof p||n.__is_event__?n:n[w];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(n=Q(),!n)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");e.unshift(n)}return t(...e)}}const H=o(U),Y=o(L),S=o(A),b=o(P),Z=o(I),l=o(O),_=o(W),ee=o(j),te=o(F),ne=o(q),se=o(T),re=o($),oe=o(k),ae=o(K),ie=o(N),ce=o(J);function ue(){return z("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:M})}function le(){return ue().use().event}const d=Symbol("fetchEvent");function fe(t){return{request:ce(t),response:ge(t),clientAddress:Y(t),locals:{},nativeEvent:t}}function de(t){return{...t}}function me(t){if(!t[d]){const e=fe(t);t[d]=e}return t[d]}function Se(t,e){for(const[n,r]of e.entries())oe(t,n,r)}class pe{event;constructor(e){this.event=e}get(e){const n=_(this.event,e);return Array.isArray(n)?n.join(", "):n||null}has(e){return this.get(e)!==void 0}set(e,n){return ee(this.event,e,n)}delete(e){return ie(this.event,e)}append(e,n){te(this.event,e,n)}getSetCookie(){const e=_(this.event,"Set-Cookie");return Array.isArray(e)?e:[e]}forEach(e){return Object.entries(l(this.event)).forEach(([n,r])=>e(Array.isArray(r)?r.join(", "):r,n,this))}entries(){return Object.entries(l(this.event)).map(([e,n])=>[e,Array.isArray(n)?n.join(", "):n])[Symbol.iterator]()}keys(){return Object.keys(l(this.event))[Symbol.iterator]()}values(){return Object.values(l(this.event)).map(e=>Array.isArray(e)?e.join(", "):e)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function ge(t){return{get status(){return b(t)},set status(e){S(t,e)},get statusText(){return Z(t)},set statusText(e){S(t,b(),e)},headers:new pe(t)}}function g(t,e=302){let n,r;typeof e=="number"?n={status:e}:({revalidate:r,...n}=e,typeof n.status>"u"&&(n.status=302));const a=new Headers(n.headers);return a.set("Location",t),r&&a.set("X-Revalidate",r.toString()),new Response(null,{...n,headers:a})}function y(t,e,n){if(typeof t!="function")throw new Error("Export from a 'use server' module must be a function");const r="";return new Proxy(t,{get(a,c,s){if(c==="url")return`${r}/_server?id=${encodeURIComponent(e)}&name=${encodeURIComponent(n)}`;if(c==="GET")return s},apply(a,c,s){const i=C();if(!i)throw new Error("Cannot call server function outside of a request");const u=de(i);return u.locals.serverFunctionMeta={id:e+"#"+n},u.serverOnly=!0,E(u,()=>t.apply(c,s))}})}const be=y(async t=>(se("auth_token","test_token"),g("/")),"c_4631","logInServer"),_e=y(async t=>(re("auth_token"),g("/login")),"c_4631","logOutServer"),we=y(async()=>{const t=ne("auth_token");return console.log(t),t?2e7:g("/login")},"c_4631","getUserProfileServer");export{_e as a,ne as b,me as c,S as d,oe as e,de as f,we as g,be as l,Se as m,se as s};
